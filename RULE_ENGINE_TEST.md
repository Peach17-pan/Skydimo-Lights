# 规则引擎验证指南

## 验证方法

### 1. 查看程序输出

程序每3秒会输出一次状态信息，包括：
- 当前时间、星期几
- CPU使用率、用户空闲时间
- **灯光模式**（根据规则引擎决定）
- 前台应用信息

### 2. 测试场景

#### 场景1：夜间弱光模式（优先级最高）
- **触发条件**：当前时间在 23:00-07:00 之间
- **预期结果**：灯光模式显示为 "夜间弱光"
- **验证方法**：
  - 等待到23:00后运行程序，或
  - 修改代码中的时间范围进行测试

#### 场景2：空闲关闭灯光
- **触发条件**：用户空闲时间 ≥ 10分钟
- **预期结果**：灯光模式显示为 "关闭灯光"
- **验证方法**：
  - 启动程序后，不要操作键盘和鼠标
  - 等待10分钟后，观察灯光模式是否变为 "关闭灯光"

#### 场景3：游戏类应用
- **触发条件**：当前应用类别为 "游戏类"
- **预期结果**：灯光模式显示为 "游戏/屏幕同步"
- **验证方法**：
  - 打开任意游戏应用（如Steam、游戏窗口等）
  - 观察灯光模式是否变为 "游戏/屏幕同步"

#### 场景4：视频类应用
- **触发条件**：当前应用类别为 "电影/视频类"
- **预期结果**：灯光模式显示为 "影视模式"
- **验证方法**：
  - 打开视频播放器（如VLC、PotPlayer等）
  - 观察灯光模式是否变为 "影视模式"

#### 场景5：音乐类应用
- **触发条件**：当前应用类别为 "音乐类"
- **预期结果**：灯光模式显示为 "音乐律动"
- **验证方法**：
  - 打开音乐播放器（如Spotify、网易云音乐等）
  - 观察灯光模式是否变为 "音乐律动"

#### 场景6：开发/办公类应用
- **触发条件**：当前应用类别为 "开发/编程类" 或 "文档/办公类"
- **预期结果**：灯光模式显示为 "办公/写代码"
- **验证方法**：
  - 打开代码编辑器（如VS Code、Cursor等）
  - 或打开办公软件（如Word、Excel等）
  - 观察灯光模式是否变为 "办公/写代码"

#### 场景7：高CPU使用率
- **触发条件**：CPU使用率 > 80%
- **预期结果**：灯光模式显示为 "游戏/屏幕同步"
- **验证方法**：
  - 运行CPU密集型任务（如编译、渲染等）
  - 观察CPU使用率超过80%时，灯光模式是否变为 "游戏/屏幕同步"

#### 场景8：默认模式
- **触发条件**：没有规则匹配
- **预期结果**：灯光模式显示为 "默认模式"
- **验证方法**：
  - 在非夜间时间，打开浏览器等未分类的应用
  - 观察灯光模式是否显示为 "默认模式"

### 3. 优先级测试

测试规则优先级是否正确：

1. **夜间 + 游戏应用**：
   - 在23:00-07:00之间打开游戏
   - 预期：应该显示 "夜间弱光"（优先级10 > 优先级8）

2. **空闲 + 游戏应用**：
   - 打开游戏后，空闲10分钟以上
   - 预期：应该显示 "关闭灯光"（优先级9 > 优先级8）

3. **高CPU + 游戏应用**：
   - 打开游戏，CPU使用率超过80%
   - 预期：应该显示 "游戏/屏幕同步"（优先级8 > 优先级3）

### 4. 调试模式

使用 `--debug` 参数运行程序，可以看到更详细的匹配信息：

```powershell
.\build\bin\Release\app_state_monitor.exe --debug
```

### 5. 修改规则进行测试

可以修改 `main.cpp` 中的 `InitializeRules` 函数来测试不同的规则组合。

## 当前规则优先级列表

| 优先级 | 条件 | 灯光模式 |
|--------|------|----------|
| 10 | 23:00-07:00 | 夜间弱光 |
| 9 | 空闲 ≥ 10分钟 | 关闭灯光 |
| 8 | 游戏类应用 | 游戏/屏幕同步 |
| 7 | 视频类应用 | 影视模式 |
| 6 | 音乐类应用 | 音乐律动 |
| 5 | 开发/编程类应用 | 办公/写代码 |
| 4 | 文档/办公类应用 | 办公/写代码 |
| 3 | CPU使用率 > 80% | 游戏/屏幕同步 |
| 0 | 默认（无匹配） | 默认模式 |

## 快速验证步骤

1. **启动程序**：
   ```powershell
   .\build\bin\Release\app_state_monitor.exe
   ```

2. **观察输出**：
   - 查看每3秒输出的状态信息
   - 重点关注 "灯光模式" 字段

3. **切换应用**：
   - 打开不同的应用（游戏、视频、音乐、代码编辑器等）
   - 观察灯光模式是否相应变化

4. **测试空闲**：
   - 停止操作键盘和鼠标
   - 等待10分钟，观察灯光模式是否变为 "关闭灯光"

5. **测试高CPU**：
   - 运行CPU密集型任务
   - 观察CPU使用率超过80%时，灯光模式是否变化

